CREATE TABLE `bads-7105-308315.supermarket.CLV_CHURN_ALT` AS
SELECT  MONTH_YEAR,
        TOTAL_CUST_MONTH,
        TOTAL_CHURN_MONTH AS NO_CHURN_END,
        LAG(TOTAL_CUST_MONTH,3) OVER (ORDER BY MONTH_YEAR) AS NO_CUST_START,
        ROUND(TOTAL_CHURN_MONTH / LAG(TOTAL_CUST_MONTH,3) OVER (ORDER BY MONTH_YEAR),4) AS CHURN_RATE,
        ROUND(1/(TOTAL_CHURN_MONTH / LAG(TOTAL_CUST_MONTH,3) OVER (ORDER BY MONTH_YEAR)),2) AS ALT
FROM (
        select MONTH_YEAR 
        , NEW_CNT + REPEAT_CNT + REACTIVATED_CNT AS TOTAL_CUST_MONTH
        , CHURN_CNT AS TOTAL_CHURN_MONTH
        from `bads-7105-308315.supermarket.CLV_CUSTOMER_MOVEMENT` 
      )
ORDER BY MONTH_YEAR
